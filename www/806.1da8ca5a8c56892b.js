"use strict";(self.webpackChunkiot_master_ui=self.webpackChunkiot_master_ui||[]).push([[806],{8989:(y,C,o)=>{o.d(C,{A:()=>Z});var t=o(4650);let Z=(()=>{var _;class T{}return(_=T).\u0275fac=function(z){return new(z||_)},_.\u0275cmp=t.Xpm({type:_,selectors:[["app-card"]],inputs:{id:"id",name:"name",title:"title",img:"img"},decls:8,vars:5,consts:[[1,"card"],[1,"card-img"],[2,"width","100%","height","100%",3,"src"],[1,"card-inf"],[2,"margin-bottom","5px"]],template:function(z,f){1&z&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"img",2),t.qZA(),t.TgZ(3,"div",3)(4,"div",4),t._uU(5),t.qZA(),t.TgZ(6,"div"),t._uU(7),t.qZA()()()),2&z&&(t.xp6(2),t.Q6J("src","assets/"+f.img,t.LSH),t.xp6(3),t.AsE("",f.title,"id: ",f.id,""),t.xp6(2),t.AsE("",f.title,"\u540d\u79f0: ",f.name,""))},styles:[".card[_ngcontent-%COMP%]{overflow:hidden;border-radius:5px;box-shadow:0 0 20px #00000080;width:200px;height:264px;background-color:#fff}.card[_ngcontent-%COMP%]   .card-img[_ngcontent-%COMP%]{box-sizing:border-box;padding:10px;border-radius:5px;box-shadow:0 0 20px #00000080}.card[_ngcontent-%COMP%]   .card-inf[_ngcontent-%COMP%]{box-sizing:border-box;padding:5px 10px;color:gray}"]}),T})()},7327:(y,C,o)=>{o.d(C,{J:()=>O});var t=o(4650),Z=o(9651),_=o(6895),T=o(6960),g=o(6497),z=o(6616),f=o(7044),E=o(1664),B=o(5545);function b(s,n){if(1&s&&t._uU(0),2&s){const a=t.oxw();t.hij("",a.title,"\u8be6\u60c5")}}function h(s,n){if(1&s&&(t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"p"),t._uU(4),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.qZA(),t.TgZ(9,"p"),t._uU(10),t.qZA(),t.TgZ(11,"p"),t._uU(12),t.qZA(),t.TgZ(13,"p"),t._uU(14),t.qZA(),t.TgZ(15,"p"),t._uU(16),t.qZA(),t.TgZ(17,"p"),t._uU(18),t.ALo(19,"date"),t.qZA()()),2&s){const a=t.oxw(2);t.xp6(2),t.hij("\u63d2\u4ef6id\uff1a",a.chooseData.id,""),t.xp6(2),t.hij("\u540d\u79f0\uff1a",a.chooseData.name,""),t.xp6(2),t.hij("\u7528\u6237\u540d\uff1a",a.chooseData.username,""),t.xp6(2),t.hij("\u5bc6\u7801\uff1a",a.chooseData.password,""),t.xp6(2),t.hij("\u5916\u7f6e\uff1a",a.chooseData.external,""),t.xp6(2),t.hij("\u7248\u672c\uff1a",a.chooseData.version,""),t.xp6(2),t.hij("\u547d\u4ee4\uff1a",a.chooseData.command,""),t.xp6(2),t.hij("\u72b6\u6001\uff1a",a.chooseData.running,""),t.xp6(2),t.hij("\u65e5\u671f\uff1a",t.lcZ(19,9,a.chooseData.created),"")}}function F(s,n){if(1&s&&(t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"p"),t._uU(4),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.ALo(9,"date"),t.qZA()()),2&s){const a=t.oxw(2);t.xp6(2),t.hij("\u4ea7\u54c1id\uff1a",a.chooseData.id,""),t.xp6(2),t.hij("\u540d\u79f0\uff1a",a.chooseData.name,""),t.xp6(2),t.hij("\u8bf4\u660e\uff1a",a.chooseData.desc,""),t.xp6(2),t.hij("\u65e5\u671f\uff1a",t.lcZ(9,4,a.chooseData.created),"")}}function M(s,n){if(1&s&&(t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"p"),t._uU(4),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.qZA(),t.TgZ(9,"p"),t._uU(10),t.ALo(11,"date"),t.qZA()()),2&s){const a=t.oxw(2);t.xp6(2),t.hij("\u603b\u7ebfid\uff1a",a.chooseData.id,""),t.xp6(2),t.hij("\u540d\u79f0\uff1a",a.chooseData.name,""),t.xp6(2),t.hij("\u8bf4\u660e\uff1a",a.chooseData.desc,""),t.xp6(2),t.hij("\u7aef\u53e3\uff1a",a.chooseData.port,""),t.xp6(2),t.hij("\u65e5\u671f\uff1a",t.lcZ(11,5,a.chooseData.created),"")}}function U(s,n){if(1&s&&(t.YNc(0,h,20,11,"div",4),t.YNc(1,F,10,6,"div",4),t.YNc(2,M,12,7,"div",4)),2&s){const a=t.oxw();t.Q6J("ngIf","\u63d2\u4ef6"===a.title),t.xp6(1),t.Q6J("ngIf","\u4ea7\u54c1"===a.title),t.xp6(1),t.Q6J("ngIf","\u603b\u7ebf"===a.title)}}function x(s,n){if(1&s){const a=t.EpF();t.TgZ(0,"button",5),t.NdJ("click",function(){t.CHM(a);const u=t.oxw();return t.KtG(u.handleEdit(u.chooseData.id))}),t._uU(1," \u7f16\u8f91 "),t.qZA(),t.TgZ(2,"button",6),t.NdJ("nzOnConfirm",function(){t.CHM(a);const u=t.oxw();return t.KtG(u.handleDelete(u.chooseData.id))})("nzOnCancel",function(){t.CHM(a);const u=t.oxw();return t.KtG(u.cancel())}),t._uU(3," \u5220\u9664 "),t.qZA(),t.TgZ(4,"button",5),t.NdJ("click",function(){t.CHM(a);const u=t.oxw();return t.KtG(u.handleClose())}),t._uU(5,"\u5173\u95ed"),t.qZA()}}let O=(()=>{var s;class n{constructor(m){this.msg=m,this.edit=new t.vpe,this.delete=new t.vpe,this.close=new t.vpe}handleEdit(m){this.edit.emit(m)}handleDelete(m){this.delete.emit(m)}handleClose(){this.close.emit()}cancel(){this.msg.info("\u53d6\u6d88\u5220\u9664")}}return(s=n).\u0275fac=function(m){return new(m||s)(t.Y36(Z.dD))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-detail"]],inputs:{chooseData:"chooseData",title:"title",isVisible:"isVisible"},outputs:{edit:"edit",delete:"delete",close:"close"},decls:7,vars:4,consts:[[3,"nzVisible","nzTitle","nzContent","nzFooter","nzVisibleChange","nzOnCancel"],["modalTitle",""],["modalContent",""],["modalFooter",""],[4,"ngIf"],["nz-button","","nzType","primary",3,"click"],["nz-button","","nzType","primary","nz-popconfirm","","nzPopconfirmTitle","\u786e\u5b9a\u5220\u9664?","nzPopconfirmPlacement","top",3,"nzOnConfirm","nzOnCancel"]],template:function(m,u){if(1&m&&(t.TgZ(0,"nz-modal",0),t.NdJ("nzVisibleChange",function(D){return u.isVisible=D})("nzOnCancel",function(){return u.handleClose()}),t.YNc(1,b,1,1,"ng-template",null,1,t.W1O),t.YNc(3,U,3,3,"ng-template",null,2,t.W1O),t.YNc(5,x,6,0,"ng-template",null,3,t.W1O),t.qZA()),2&m){const A=t.MAs(2),D=t.MAs(4),v=t.MAs(6);t.Q6J("nzVisible",u.isVisible)("nzTitle",A)("nzContent",D)("nzFooter",v)}},dependencies:[_.O5,T.du,g.JW,z.ix,f.w,E.dQ,B.u]}),n})()},3806:(y,C,o)=>{o.r(C),o.d(C,{BrokerModule:()=>j});var t=o(6895),Z=o(8284),_=o(3325),T=o(7423),g=o(6704),z=o(5635),f=o(6616),E=o(269),B=o(2577),b=o(9166),h=o(433),F=o(7096),M=o(1971),U=o(6903),x=o(4575),O=o(5380),s=o(235),n=o(4650),a=o(1445),m=o(9651),u=o(3679);function A(i,d){1&i&&(n.ynx(0),n._uU(1,"\u8bf7\u8f93\u5165\u540d\u79f0!"),n.BQk())}function D(i,d){1&i&&n.YNc(0,A,2,0,"ng-container",14),2&i&&n.Q6J("ngIf",d.$implicit.hasError("required"))}let v=(()=>{var i;class d{constructor(e,r,l){this.fb=e,this.rs=r,this.msg=l,this.id=""}ngOnInit(){this.id&&this.rs.get(`broker/${this.id}`).subscribe(e=>{this.build(e.data)}),this.build()}build(e){this.group=this.fb.group({id:[(e=e||{}).id||"",[]],name:[e.name||"",[h.kI.required]],desc:[e.desc||"",[]],port:[e.port||1883,[]],cert:[e.cert||"",[]],key:[e.key||"",[]]})}submit(){return new Promise((e,r)=>{this.group.valid?this.rs.post(this.id?`broker/${this.id}`:"broker/create",this.group.value).subscribe(c=>{this.msg.success("\u4fdd\u5b58\u6210\u529f"),e(!0)}):Object.values(this.group.controls).forEach(l=>{l.invalid&&(l.markAsDirty(),l.updateValueAndValidity({onlySelf:!0}),r())})})}}return(i=d).\u0275fac=function(e){return new(e||i)(n.Y36(h.qu),n.Y36(a.s),n.Y36(m.dD))},i.\u0275cmp=n.Xpm({type:i,selectors:[["app-brokers-edit"]],inputs:{id:"id"},decls:28,vars:24,consts:[["nz-form","",3,"formGroup","ngSubmit"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],[3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","name"],["nameErrorTpl",""],["nzFor","desc",3,"nzSm","nzXs"],["nzErrorTip","",3,"nzSm","nzXs"],["nz-input","","formControlName","desc"],["nzFor","port",3,"nzSm","nzXs"],["formControlName","port",3,"nzMax","nzMin"],["nzFor","cert",3,"nzSm","nzXs"],["nz-input","","formControlName","cert"],["nzFor","key",3,"nzSm","nzXs"],["nz-input","","formControlName","key"],[4,"ngIf"]],template:function(e,r){if(1&e&&(n.TgZ(0,"form",0),n.NdJ("ngSubmit",function(){return r.submit()}),n.TgZ(1,"nz-form-item")(2,"nz-form-label",1),n._uU(3,"\u540d\u79f0"),n.qZA(),n.TgZ(4,"nz-form-control",2),n._UZ(5,"input",3),n.YNc(6,D,1,1,"ng-template",null,4,n.W1O),n.qZA()(),n.TgZ(8,"nz-form-item")(9,"nz-form-label",5),n._uU(10,"\u8bf4\u660e"),n.qZA(),n.TgZ(11,"nz-form-control",6),n._UZ(12,"textarea",7),n.qZA()(),n.TgZ(13,"nz-form-item")(14,"nz-form-label",8),n._uU(15,"\u7aef\u53e3"),n.qZA(),n.TgZ(16,"nz-form-control",6),n._UZ(17,"nz-input-number",9),n.qZA()(),n.TgZ(18,"nz-form-item")(19,"nz-form-label",10),n._uU(20,"cert"),n.qZA(),n.TgZ(21,"nz-form-control",2),n._UZ(22,"input",11),n.qZA()(),n.TgZ(23,"nz-form-item")(24,"nz-form-label",12),n._uU(25,"key"),n.qZA(),n.TgZ(26,"nz-form-control",2),n._UZ(27,"input",13),n.qZA()()()),2&e){const l=n.MAs(7);n.Q6J("formGroup",r.group),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",l),n.xp6(5),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(1),n.Q6J("nzMax",65535)("nzMin",100),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24)}},dependencies:[t.O5,u.t3,u.SK,g.Lr,g.Nx,g.iK,g.Fd,z.Zp,h._Y,h.Fj,h.JJ,h.JL,h.sg,h.u,F._V]}),d})();var P=o(6960),S=o(1634),J=o(5227),k=o(8989),I=o(7327),Q=o(1918),N=o(558);function X(i,d){if(1&i){const p=n.EpF();n.TgZ(0,"div",6),n.NdJ("click",function(){const l=n.CHM(p).$implicit,c=n.oxw();return n.KtG(c.informate(l))}),n._UZ(1,"app-card",7),n.qZA()}if(2&i){const p=d.$implicit;n.xp6(1),n.Q6J("img","server.png")("id",p.id)("name",p.name)("title","\u603b\u7ebf")}}let K=(()=>{var i;class d{constructor(e,r,l,c){this.modal=e,this.router=r,this.rs=l,this.msg=c,this.uploading=!1,this.loading=!0,this.isVisible=!1,this.datum=[],this.total=1,this.pageSize=20,this.pageIndex=1,this.query={},this.chooseData={},this.checked=!1,this.indeterminate=!1,this.setOfCheckedId=new Set,this.delResData=[],this.pageSizeChange(this.pageSize)}reload(){this.datum=[],this.load()}load(){this.loading=!0,this.rs.post("broker/search",this.query).subscribe(e=>{this.datum=e.data||[],this.total=e.total}).add(()=>{this.loading=!1})}close(){this.isVisible=!1}informate(e){this.isVisible=!0,this.rs.get(`broker/${e.id}`,this.query).subscribe(r=>{this.chooseData=r.data}).add(()=>{this.loading=!1})}create(){let e="/broker/create";location.pathname.startsWith("/admin")&&(e="/admin"+e),this.router.navigateByUrl(e)}delete(e,r){this.rs.get(`broker/${e}/delete`).subscribe(l=>{r?r&&(this.delResData.push(l),r===this.delResData.length&&(this.msg.success("\u5220\u9664\u6210\u529f"),this.load())):(this.msg.success("\u5220\u9664\u6210\u529f"),this.datum=this.datum.filter(c=>c.id!==e),this.load())})}handleExport(){this.href="/api/broker/export"}onQuery(e){(0,O.r)(e,this.query),this.load()}pageIndexChange(e){this.query.skip=e-1,this.load()}pageSizeChange(e){this.query.limit=e,this.load()}search(e){this.query.keyword={name:e},this.query.skip=0,this.load()}handleEdit(e){this.isVisible=!1;const l=this.modal.create({nzTitle:e?"\u7f16\u8f91\u603b\u7ebf":"\u521b\u5efa\u603b\u7ebf",nzStyle:{top:"20px"},nzContent:v,nzComponentParams:{id:e},nzMaskClosable:!1,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>{l.destroy()}},{label:"\u4fdd\u5b58",type:"primary",onClick:c=>{c.submit().then(()=>{l.destroy(),this.load()},()=>{})}}]})}cancel(){this.msg.info("\u53d6\u6d88\u64cd\u4f5c")}getTableHeight(){return(0,s.NC)(this)}handleBatchDel(){(0,s.mK)(this)}handleAllChecked(e){(0,s.Yk)(e,this)}handleItemChecked(e,r){(0,s.mp)(e,r,this)}}return(i=d).\u0275fac=function(e){return new(e||i)(n.Y36(P.Sf),n.Y36(x.F0),n.Y36(a.s),n.Y36(m.dD))},i.\u0275cmp=n.Xpm({type:i,selectors:[["app-brokers"]],decls:7,vars:9,consts:[["placeholder","\u8bf7\u8f93\u5165\u540d\u79f0",3,"onSearch"],["uploadApi","/api/broker/import","downloadApi","/api/broker/export",3,"showDelBtn","add"],["nz-row","",1,"card",3,"nzGutter"],["nz-col","","class","card-item",3,"click",4,"ngFor","ngForOf"],[3,"isVisible","title","chooseData","edit","delete","close"],["nzShowSizeChanger","",2,"position","fixed","bottom","0","right","10px",3,"nzPageIndex","nzTotal","nzPageSize","nzPageSizeChange","nzPageIndexChange"],["nz-col","",1,"card-item",3,"click"],[3,"img","id","name","title"]],template:function(e,r){1&e&&(n.TgZ(0,"app-toolbar")(1,"app-search-form",0),n.NdJ("onSearch",function(c){return r.search(c)}),n.qZA(),n.TgZ(2,"app-batch-btn",1),n.NdJ("add",function(){return r.handleEdit()}),n.qZA()(),n.TgZ(3,"div",2),n.YNc(4,X,2,4,"div",3),n.qZA(),n.TgZ(5,"app-detail",4),n.NdJ("edit",function(c){return r.handleEdit(c)})("delete",function(c){return r.delete(c)})("close",function(){return r.close()}),n.qZA(),n.TgZ(6,"nz-pagination",5),n.NdJ("nzPageSizeChange",function(c){return r.pageSizeChange(c)})("nzPageIndexChange",function(c){return r.pageIndexChange(c)}),n.qZA()),2&e&&(n.xp6(2),n.Q6J("showDelBtn",!1),n.xp6(1),n.Q6J("nzGutter",16),n.xp6(1),n.Q6J("ngForOf",r.datum),n.xp6(1),n.Q6J("isVisible",r.isVisible)("title","\u603b\u7ebf")("chooseData",r.chooseData),n.xp6(1),n.Q6J("nzPageIndex",r.pageIndex)("nzTotal",r.total)("nzPageSize",r.pageSize))},dependencies:[t.sg,u.t3,u.SK,S.dE,J.n,k.A,I.J,Q.o,N.q],styles:[".card[_ngcontent-%COMP%]{box-sizing:border-box;padding:10px 20px;width:100%}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]{box-sizing:border-box;padding:5px}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),d})();var V=o(1346);const Y=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:K},{path:"detail/:id",component:(()=>{var i;class d{}return(i=d).\u0275fac=function(e){return new(e||i)},i.\u0275cmp=n.Xpm({type:i,selectors:[["app-broker-detail"]],decls:2,vars:0,template:function(e,r){1&e&&(n.TgZ(0,"p"),n._uU(1,"broker-detail works!"),n.qZA())}}),d})()},{path:"edit/:id",component:v},{path:"create",component:v},{path:"**",component:V.r}];let L=(()=>{var i;class d{}return(i=d).\u0275fac=function(e){return new(e||i)},i.\u0275mod=n.oAB({type:i}),i.\u0275inj=n.cJS({imports:[x.Bz.forChild(Y),x.Bz]}),d})();var R=o(6497);let j=(()=>{var i;class d{}return(i=d).\u0275fac=function(e){return new(e||i)},i.\u0275mod=n.oAB({type:i}),i.\u0275inj=n.cJS({imports:[t.ez,L,Z.wm,_.ip,T.PV,R._p,g.U5,P.Qp,S.uK,z.o7,f.sL,E.HQ,B.S,b.Y,h.UX,F.Zf,M.vh,U.zf]}),d})()}}]);